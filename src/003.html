<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>002 to-do-list</title>
    <script src="https://kit.fontawesome.com/699f943a60.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: Microsoft JhengHei;
            font-weight: 800;
            font-size: 1.1rem;
        }

        .wrapper {
            width: 100%;
            height: 100%;
        }

        .nav-container {
            height: 35px;
            width: 100%;
            border-bottom: 1px solid rgba(142, 186, 243, 0.9);
            align-items: center;
            display: flex;
            background-color: rgba(142, 186, 243, 0.7);
        }

        .nav-left-container {
            width: 60%;
        }

        .nav-right-container {
            width: 35%;
        }

        .nav-right-item {
            float: right;
            margin-left: 20px;
            display: block;
        }

        .left-icon {
            margin-left: 10px;
        }

        .user-name {
            margin-left: 8px;
            color: black;
            font-weight: 800;
        }

        .main-container {
            height: 600px;
            background-color: rgba(142, 186, 243, 0.7);
        }

        .msg-wrapper {
            margin-bottom: 8px;
        }

        .msg-wrapper:not(:first-child) {
            margin-top: 8px;

        }

        .msg-text {
            padding: 6px;
            max-width: 50%;
            border-radius: 10px;
        }

        .left-msg-text {
            float: left;
            margin-left: 7px;
            background-color: white;
        }

        .right-msg-text {
            float: right;
            margin-right: 6px;
            background-color: rgba(157, 230, 148, 0.9);
        }

        .status-wrapper {
            position: relative;
        }

        .left-msg-status-wrapper {
            float: left;
            margin-left: 6px;
            text-align: left;
        }

        .right-msg-status-wrapper {
            float: right;
            margin-right: 8px;
            text-align: right;
        }

        .status-text {
            color: rgba(61, 87, 124, 0.9);
            font-size: 0.8rem;
        }

        .user-img {
            width: 30px;
            float: left;
            margin-left: 5px;
        }

        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }
    </style>
</head>

<body>
    <div id="root">
        <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
        <!-- 引入 React 和 ReactDOM 的 JavaScript 文件 -->
        <script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.development.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.development.js"></script>
        <script type="text/babel">

            const { useState, useEffect, useRef } = React;
            const App = () => {
                const [msgList, setMsgList] = useState([])

                const NavArea = () => {

                    return (
                        <div className={'nav-container'}>
                            <div className={'nav-left-container'}>
                                <i className="fa-solid fa-chevron-left left-icon"></i>
                                <span className="user-name">Chicardo</span>
                            </div>
                            <div className={"nav-right-container"}>
                                <i className="fas fa-list nav-right-item"></i>
                                <i className="fas fa-phone nav-right-item"></i>
                                <i className="fas fa-search nav-right-item"></i>
                            </div>
                        </div >

                    )
                }

                const RightMessage = (props) => {

                    return (
                        <div className={'msg-wrapper clearfix'} id={`msg-wrapper${props.id}`}>
                            <div className="msg-text right-msg-text">{props.msg}</div>
                            <div className="status-wrapper right-msg-status-wrapper status-text" id={`msg-status-wrapper${props.id}`}>
                                <div className="right-msg-status">{props.status}</div>
                                <div className="right-msg-date">{props.date}</div>
                            </div>
                        </div>
                    )
                }

                const LeftMessage = (props) => {

                    return (
                        <div className={'msg-wrapper clearfix'} id={`msg-wrapper${props.id}`}>
                            <img src="image/user.jpg" className="user-img"></img>
                            <div className="msg-text left-msg-text">{props.msg}</div>
                            <div className="status-wrapper left-msg-status-wrapper status-text" id={`msg-status-wrapper${props.id}`}>
                                <div className="left-msg-date">{props.date}</div>
                            </div>
                        </div>
                    )
                }


                useEffect(() => {

                    const msgs = [
                        { user: "me", msg: "Hi 下涵", status: "已讀", date: "上午 10:51" },
                        { user: "me", msg: "你想去哪裡玩", status: "已讀", date: "上午 10:51" },
                        { user: "ricardo", msg: "我嗎", status: "已讀", date: "上午 10:52" },
                        { user: "ricardo", msg: "好想去美國好想去美國好想去美國好想去美國好想去", status: "已讀", date: "上午 10:52" }
                    ]
                    setMsgList(msgs)

                }, [])

                useEffect(() => {

                    msgList.forEach((msgItem, index) => {
                        const msgWrapper = document.getElementById(`msg-wrapper${index}`);
                        const msgStatusWrapper = document.getElementById(`msg-status-wrapper${index}`);
                        console.log(`${index} msgWrapper: ${msgWrapper.offsetHeight} stautusWrapper: ${msgStatusWrapper.offsetHeight}`)
                        if (msgWrapper && msgStatusWrapper) {
                            msgStatusWrapper.style.top = (msgWrapper.offsetHeight - msgStatusWrapper.offsetHeight) + "px";
                        }
                    });

                }, [msgList]);

                return (
                    <div className={"wrapper"}>

                        <NavArea />

                        <div className={'main-container'}>

                            {msgList.map((msgItem, index) => {
                                if (msgItem.user === "me")
                                    return <RightMessage msg={msgItem.msg} status={msgItem.status} date={msgItem.date} id={index} />

                                return <LeftMessage msg={msgItem.msg} date={msgItem.date} id={index} />
                            })}
                        </div>
                    </div >
                );
            };

            ReactDOM.render(<App />, document.getElementById('root'));
        </script>
    </div>
</body>

</html>